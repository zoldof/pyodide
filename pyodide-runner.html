<script type="module">
  import initPyodide from "https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js";

  try {
    const pyodide = await initPyodide();
    console.log("Pyodide initialized successfully");

    const params = new URLSearchParams(location.search);
    const filename = params.get("file");
    const repo = params.get("repo");

    // Pythonファイルがある固定リポジトリのURL
    const baseUrl = "https://zoldof.github.io/";
    const fullUrl = baseUrl + encodeURIComponent(repo) + "/" + encodeURIComponent(filename);
    console.log("Full URL:", fullUrl);  // URLを確認

    const res = await fetch(fullUrl);
    if (!res.ok) {
      throw new Error(`HTTP error! status: ${res.status}`);
    }
    const code = await res.text();

    // PyodideでPythonコードを実行
    await pyodide.runPythonAsync(code);

    // Pythonで定義した関数を呼び出す
    const result = pyodide.globals.get("greet")("World");
    document.body.innerHTML = `<pre>${result}</pre>`;
  } catch (err) {
    console.error("Error:", err);
    document.body.innerHTML = `<pre>エラー: ${err}</pre>`;
  }
</script>

