<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pyodideでhello.pyを読み込む</title>
</head>
<body>
  <h1>Pyodide 実験（外部ファイル読み込み）</h1>
  <pre id="output">実行中...</pre>

  <script type="module">
    const params = new URLSearchParams(location.search);
    const repo = params.get('repo');
    const file = params.get('file');

    import { loadPyodide } from "https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.mjs";
    const pyfile = await fetch("https://zoldof.github.io/${repo}/${file}");
    const pyodide = await loadPyodide();
    const scriptText = await pyfile.text();

    // 実行して関数を定義
    await pyodide.runPythonAsync(scriptText);

    // Python 関数を JS から呼び出す
    const greet = pyodide.globals.get('greet');
    const result = greet("流川町からの旅人");

    document.getElementById("output").textContent = result;

    // メモリリーク対策（不要なら省略可）
    greet.destroy();
  </script>
</body>
</html>
